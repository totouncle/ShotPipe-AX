name: ğŸš€ Windows ë°°í¬ ë¹Œë“œ

on:
  # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥
  workflow_dispatch:
    inputs:
      version:
        description: 'ë²„ì „ ë²ˆí˜¸ (ì˜ˆ: v1.3.0)'
        required: false
        default: 'v1.3.0'
  
  # ë©”ì¸ ë¸Œëœì¹˜ì— í‘¸ì‹œí•  ë•Œ ìë™ ì‹¤í–‰
  push:
    branches: [ main ]
    paths:
      - 'shotpipe/**'
      - 'main.py'
      - 'requirements.txt'
      - '.github/workflows/build-windows.yml'

jobs:
  build-windows:
    name: ğŸ–¥ï¸ Windows ì¸ìŠ¤í†¨ëŸ¬ ë¹Œë“œ
    runs-on: windows-latest
    
    steps:
    - name: ğŸ“ ì†ŒìŠ¤ì½”ë“œ ì²´í¬ì•„ì›ƒ
      uses: actions/checkout@v4
      
    - name: ğŸ Python ì„¤ì •
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
        
    - name: ğŸ”§ Python ì˜ì¡´ì„± ì„¤ì¹˜
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install pyinstaller
        
    - name: ğŸ—ï¸ NSIS ì„¤ì¹˜
      run: |
        choco install nsis -y
        
    - name: ğŸš€ ë…ë¦½í˜• ì‹¤í–‰íŒŒì¼ ë¹Œë“œ
      run: |
        echo "ğŸ”¨ PyInstallerë¡œ ì‹¤í–‰íŒŒì¼ ìƒì„± ì¤‘..."
        pyinstaller shotpipe.spec
        
    - name: ğŸ NSIS ì¸ìŠ¤í†¨ëŸ¬ ë¹Œë“œ
      run: |
        echo "ğŸ“¦ NSIS ì¸ìŠ¤í†¨ëŸ¬ ìƒì„± ì¤‘..."
        makensis ShotPipe_Installer.nsi
        
    - name: ğŸ“¦ í¬í„°ë¸” ë²„ì „ ìƒì„±
      run: |
        echo "ğŸ“ í¬í„°ë¸” ë²„ì „ íŒ¨í‚¤ì§• ì¤‘..."
        New-Item -ItemType Directory -Force -Path "ShotPipe_Portable"
        Copy-Item "dist\ShotPipe.exe" "ShotPipe_Portable\"
        Copy-Item "README.md" "ShotPipe_Portable\"
        Copy-Item "LICENSE.txt" "ShotPipe_Portable\"
        Compress-Archive -Path "ShotPipe_Portable" -DestinationPath "ShotPipe_v1.3.0_Portable.zip" -Force
        
    - name: ğŸ“¤ ë¹Œë“œ ê²°ê³¼ë¬¼ ì—…ë¡œë“œ
      uses: actions/upload-artifact@v4
      with:
        name: ShotPipe-Windows-Build
        path: |
          ShotPipe_Setup.exe
          ShotPipe_*.zip
          dist/ShotPipe.exe